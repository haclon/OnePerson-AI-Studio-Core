# {{PROJECT_ABBR}} 开发规则

> 本文件定义了 AI 辅助开发时需要遵循的核心规范和约定。  
> 详细的代码规范请参阅对应的 guidelines 文档。

---

## 1. 项目概述

- **系统名称**：{{PROJECT_NAME}}
- **项目缩写**：{{PROJECT_ABBR}}
- **技术栈**：{{TECH_STACK}}

---

## 2. 通用开发原则

1. **编码格式**：所有文件使用 {{ENCODING}} 编码
2. **注释语言**：所有注释和文档使用{{COMMENT_LANGUAGE}}
3. **中文检查**：生成中文内容时必须检查是否有乱码，如有乱码需修正
4. **增量修改**：修改函数前先理解原有逻辑，在原基础上增量修改，不要移除已有功能
5. **专注当前任务**：只专注当前 instruction 要求的功能，不要擅自修改其他功能

---

## 3. AI 行为规则（每次对话必须遵守）

### 3.1 诊断指令约定

当用户输入以 **`?`** 或 **`/task`** 开头时，AI 必须进入"任务诊断模式"：

**输出格式**：`[任务类型] 推荐模型 + 推荐Agent (简短原因)`

**示例**：
- `? 加个字段` → `[写代码] GPT-5.2 + BE-后端开发 (后端字段改动)`
- `? 这个需求怎么拆` → `[讨论] Sonnet 4.5 + Spec-平台架构师 (需求澄清)`
- `? 批量重命名变量` → `[批量] Grok Code + Batch-机械改动 (机械操作)`
- `? 页面样式要调整` → `[写代码] GPT-5.2 + FE-前端开发 (前端改动)`
- `? 页面报错了` → `[Bug] GPT-5.2 + Bug-定位与修复 (问题定位)`
- `? 我想加个新功能但还没想好怎么做` → `[讨论] Sonnet 4.5 + PRD-需求分析 (需求梳理)`

### 3.2 自动诊断流程

即使没有 `?` 指令，AI 也要根据用户问题进行判断：
- 需求澄清/讨论 → 应使用 Sonnet/Opus
- 写代码/改代码 → 应使用 GPT-5.2/Codex Max
- 批量机械操作 → 应使用 Grok Code
- 复杂 bug 排查 → 应使用 Opus

### 3.3 模型不匹配时

礼貌提醒用户切换更合适的模型（但仍然尽力完成任务）

### 3.4 大改动提醒

如果任务需要大改动，主动提醒走 OpenSpec 流程

---

## 4. 模型能力边界

| 模型 | 擅长 | 不擅长 |
|------|------|--------|
| **Opus 4.5** | 复杂推理、需求澄清、风险评估 | 性价比低，不适合简单任务 |
| **Sonnet 4.5** | 理解需求、写文档、日常讨论 | 不如 Opus 深度推理 |
| **GPT-5.2** | 写代码、改代码、日常开发 | 没有联网，不擅长讨论 |
| **Codex Max** | 大规模重构、代码生成 | 不擅长需求讨论 |
| **Grok Code** | 批量机械操作 | 复杂逻辑不行 |

---

## 5. 模型选择策略（快速参考）

> 核心原则：**质量 > 成本 > 时间**

### 5.1 快速对照表

| 我要做什么 | 推荐模型 | 为什么 |
|-----------|----------|--------|
| 讨论需求/理清思路 | **Sonnet 4.5** | 理解能力强 |
| 定义边界/评估风险 | **Opus 4.5** | 最稳，不跑偏 |
| 日常写代码 | **GPT-5.2** | 便宜够用 |
| 大规模改代码（10+文件） | **Codex Max** | 代码能力强，更便宜 |
| 批量重复操作 | **Grok Code** | 最便宜 |
| 修简单 bug | **GPT-5.2** | 够用 |
| 查复杂 bug | **Opus 4.5** | 推理能力强 |
| 写文档/注释 | **Sonnet 4.5** | 表达好 |
| 需要联网查资料 | **Sonnet 4.5** | 有联网能力 |
| 理解大型代码库 | **Sonnet 4.5 (Max)** | 1M 上下文 |

### 5.2 判断任务大小

| 范围 | 标准 |
|------|------|
| 小 | 1-3 个文件，<100 行 |
| 中 | 3-10 个文件，100-500 行 |
| 大 | 10+ 个文件，>500 行 |

### 5.3 推荐工作流

```text
1. 想清楚（Sonnet/Opus）→ 2. 写代码（GPT-5.2/Codex Max）→ 3. 有问题再切回
```

---

## 6. Agent 角色与模型匹配

| 角色 | 职责 | 推荐模型 |
|------|------|----------|
| **Spec/PRD** | 需求澄清、边界定义 | Sonnet 4.5（主），Opus 4.5（复杂时） |
| **FE/BE** | 写代码 | GPT-5.2（日常），Codex Max（重构） |
| **QA/Bug** | 问题定位 | GPT-5.2（简单），Opus 4.5（复杂） |
| **Batch** | 机械改动 | Grok Code |

---

## 7. 工单模板（必须使用）

每次给 Agent 的提示词应包含：

```text
【目标】一句话说明要实现什么
【范围】改哪些 / 不改哪些
【验收标准】如何判断完成
【约束】遵循 .cursorrules；中文注释；增量修改
```

---

## 8. 大改动走 OpenSpec

满足**任意一条**必须走 OpenSpec：
- 跨模块（前后端联动）
- 涉及数据库表结构
- 引入新规范/模式
- 需求边界模糊

OpenSpec 流程：`proposal → validate → approval → apply`

---

## 9. 相关文档

详细的代码规范与开发指南请参阅：

| 文档 | 用途 |
|------|------|
| `docs/frontend-guidelines.md` | 前端页面模板、Base 组件复用、样式规范 |
| `docs/backend-guidelines.md` | 后端 API 设计、分层架构、异步编程规范 |
| `docs/database-guidelines.md` | 数据库命名、迁移流程、索引策略 |
| `docs/agent-playbook.md` | 完整版 Agent 使用手册、决策树、省钱技巧 |

